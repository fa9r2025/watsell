<div class="whatsapp-button-container" style="margin: 10px 0;">
  <a
    class="wa-btn-link"
    href="#"
    target="_blank"
    style="
      display:flex;
      align-items:center;
      justify-content:center;
      background-color: {{ block.settings.button_color }};
      color: white;
      padding: 12px 25px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      font-family: inherit;
    "
  >
    <img src="{{ 'whatsapp-icon.png' | asset_url }}" width="25" height="25" style="margin-right:10px;">
    <span>{{ block.settings.button_text }}</span>
  </a>
</div>

<script>
(function () {
  function initWAButton(root) {
    const btn = root.querySelector(".wa-btn-link");
    if (!btn) return;

    const productTitle = {{ product.title | json }};
    const productUrl = window.location.href;
    const phoneNumber = "{{ block.settings.phone_number }}".replace(/\s+/g, "");
    const base = `{{ block.settings.message_template | escape }}`;

    const msg = `${base}\n${productTitle}\n${productUrl}`;

    // ğŸ”¥ Ø³Ø¬Ù„ click ÙÙŠ Ø§Ù„Ù€ App
    fetch("/apps/watsell/api/clicks", { method: "POST" });

    // Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨
    btn.href = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(msg)}`;
  }

  initWAButton(document.currentScript.closest(".whatsapp-button-container") || document);

  document.addEventListener("shopify:section:load", function (event) {
    initWAButton(event.target);
  });
})();
</script>

{% schema %}
{
  "name": "WhatsApp Order Button",
  "target": "section",
  "settings": [
    { "type": "text", "id": "phone_number", "label": "Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ø¨Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„ÙŠ)", "default": "216XXXXXXXX" },
    { "type": "text", "id": "button_text", "label": "Ù†Øµ Ø§Ù„Ø²Ø±", "default": "Ø§Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨" },
    {
      "type": "textarea",
      "id": "message_template",
      "label": "Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©",
      "default": "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬:"
    },
    { "type": "color", "id": "button_color", "label": "Ù„ÙˆÙ† Ø§Ù„Ø²Ø±", "default": "#25D366" }
  ]
}
{% endschema %}

